<div class="container" style="text-align: center;">
    <div class="note">
        <span class="title1">âœ¨å‚è€ƒèµ„æ–™</span> 
    </div> 
</div>

é±¼çš®çš„ MySQL å­¦ä¹ ç½‘ç«™ï¼šhttp://sqlmother.yupi.icu/

---

<div class="container" style="text-align: center;">
    <div class="note">
        <span class="title1">âœ¨å¸¸ç”¨å‡½æ•°</span> 
    </div> 
</div>

### â­• èšåˆå‡½æ•°

`sum()`ã€`avg()`ã€`count()`ã€`max()`ã€`min()`  

ä¸€èˆ¬å¯ä»¥é…åˆ `group by` ä½¿ç”¨  
åˆ†ç»„ `group by ..., ...` æ”¯æŒå¤šå­—æ®µ  

### â­• å…³äºæ—¥æœŸ

`date()`ã€`datetime()`ã€`time()`

``` sql
-- æŸ¥çœ‹ Date1 ä¸ Date2 ç›¸å·®çš„æ—¶é—´
datediff(Date1, Date2)
```

- æ—¶é—´æ®µæ•°æ®

    ``` sql
    -- æ³¨æ„æ—¶é—´è¦æœ‰å¼•å·
    time >= '2020-01-01 00:00:00' AND time <= '2020-12-31 23:59:59'
    ```

    ç­‰åŒäº  

    ``` sql
    time BETWEEN '2020-01-01 00:00:00' AND '2020-12-31 23:59:59'
    ```

``` sql
-- å°†å­—ç¬¦é€šè¿‡æŒ‡å®šçš„æ ¼å¼è½¬æ¢æˆæ—¥æœŸ  
str_to_date

-- å°†æ—¥æœŸè½¬æ¢æˆå­—ç¬¦  
date_format
```

### â­• æ’åº  

``` sql
-- å…ˆå¯¹æŸå­—æ®µ a å‡åºæ’åºï¼Œå†å¯¹æŸå­—æ®µ b é™åºæ’åº  
select ... from ...
order by a asc, b desc
```

### â­• å…³äºå­—ç¬¦ä¸²

#### ğŸ”˜ åˆ¤æ–­æ˜¯å¦ä¸ºç©º
    
``` sql
-- åˆ¤æ–­ a æ˜¯å¦ä¸ºç©º
isnull(a)
```

``` sql
-- è‹¥ a ä¸ä¸º nullï¼Œåˆ™è¿”å› aï¼Œå¦åˆ™è¿”å› b
ifnull(a, b)
```

#### ğŸ”˜ å­—ç¬¦ä¸²è½¬æ¢ã€æˆªå–ã€æ‹¼æ¥ç­‰å¤„ç†

``` sql
-- å°†å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™
upper(...)

-- å°†å­—ç¬¦ä¸²è½¬ä¸ºå°å†™
lower(...)
```

``` sql
-- æˆªå–ä»æŒ‡å®šç´¢å¼•å¤„æŒ‡å®šå­—ç¬¦é•¿åº¦çš„å­—ç¬¦  
substr(å­—ç¬¦ä¸²,1,3)

-- æ‹¼æ¥å­—ç¬¦ä¸²  
concat(a, b)
```

``` sql
-- å­—ç¬¦ä¸²é•¿åº¦
length()
```

``` sql
-- å»æ‰é¦–å°¾å­—ç¬¦
trim
```

``` sql
-- è¿”å›å­ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¿”å› 0  
instr(å­—ç¬¦ä¸²ï¼Œå­—ç¬¦)
```

---

<div class="container" style="text-align: center;">
    <div class="note">
        <span class="title1">âœ¨ä¸€äº›è¯­å¥</span> 
    </div> 
</div>

### â­• `case when`

``` sql
select 
    ...,
    case
        when ... then ...
        when ... then ...
        else ...
    end as ...
from ...
```

### â­• å­æŸ¥è¯¢ `exists`

``` sql
-- é€šå¸¸åµŒå¥—çš„ select è¯­å¥
select 
    var
from ...
where var in (
    åˆä¸€ä¸ª select è¯­å¥
)
```

``` sql
-- ç”¨äºæ£€æŸ¥ä¸»æŸ¥è¯¢çš„ç»“æœé›†æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå®ƒè¿”å›å¸ƒå°”å€¼ï¼ˆTrue æˆ– Falseï¼‰ï¼Œè€Œä¸è¿”å›å®é™…çš„æ•°æ®
select 
    var
from ...
where exists(
    åˆä¸€ä¸ª select è¯­å¥
)
```

### â­• æ‹¼æ¥è¡¨

``` sql
-- è¿”å›çš„æ•°æ®å·²å»é‡
æŸ¥è¯¢è¯­å¥1
union
æŸ¥è¯¢è¯­å¥2

-- è¿”å›çš„æ•°æ®ä¸­å¯èƒ½å­˜åœ¨é‡å¤å€¼
æŸ¥è¯¢è¯­å¥1
union all
æŸ¥è¯¢è¯­å¥2
```

---

<div class="container" style="text-align: center;">
    <div class="note">
        <span class="title1">âœ¨çª—å£å‡½æ•°</span> 
    </div> 
</div>

çª—å£å‡½æ•°æ˜¯ä¸€ç§å¼ºå¤§çš„æŸ¥è¯¢å·¥å…·  
å®ƒå…è®¸æˆ‘ä»¬åœ¨æŸ¥è¯¢ä¸­ **å¯¹åˆ†ç»„æ•°æ®** è¿›è¡Œè®¡ç®—ï¼ŒåŒæ—¶ **ä¿ç•™åŸå§‹è¡Œçš„è¯¦ç»†ä¿¡æ¯**  
çª—å£å‡½æ•°é€šè¿‡ **æŒ‡å®šçš„å­—æ®µå°†æ•°æ®åˆ†ä¸ºå‡ ä¸ªçª—å£**ï¼Œå†ä½¿ç”¨ **èšåˆå‡½æ•°** è¿›è¡Œåˆ†æ  

çª—å£å‡½æ•°æœ‰ï¼š`rank`ã€`dense_rank`ã€`row_number`ï¼Œè¿˜æœ‰æ‰€æœ‰çš„èšåˆå‡½æ•°ç­‰ç­‰  
åŒ…æ‹¬é™æ€çª—å£ã€æ»‘åŠ¨çª—å£  

### â­• ç‰¹ç‚¹

ç›¸è¾ƒäº `group by`ï¼Œçª—å£å‡½æ•°æ‰§è¡Œå®Œåæ•°æ®çš„ **æ¡æ•°ä¸å˜**  
åªèƒ½åœ¨ `select` å­å¥é‡Œé¢  

### â­• ç¤ºä¾‹

#### ğŸ”˜ åˆ†ç»„åç»„å†…æ±‚å’Œ

``` sql
select 
    ...,
    sum(è®¡ç®—å­—æ®µå) over (
        partition by åˆ†ç»„å­—æ®µå
    ) as ...
from ...
-- ä¸Šè¿°çš„ sum å‡½æ•°ä¹Ÿå¯ä»¥æ›¿æ¢æˆ avg æˆ–è€… minã€max ç­‰
```

ä¸Šè¿°çš„è¯­å¥ä¼šå‘ç°ç»“æœå­—æ®µæ˜¯æ€»å’Œï¼Œè‹¥éœ€è¦ **åŒç»„å†…çš„ç´¯åŠ å’Œ**ï¼Œåˆ™éœ€è¦åŠ ä¸Š `order by`

``` diff
select 
    ...,
    sum(è®¡ç®—å­—æ®µå) over (
        partition by åˆ†ç»„å­—æ®µå
+         order by æ ¹æ®æŸå­—æ®µæ’åº
    ) as ...
from ...
```

#### ğŸ”˜ æ’åºå‡½æ•°

`rank()` ä¼šå‡ºç°å¹¶åˆ—æ’å

``` sql
select
    ...,
    rank() over (
        partition by åˆ†ç»„å­—æ®µ 
        order by æ’åºå­—æ®µ desc 
        rows between ... and ...
    ) as ...
from ...
```

`row_number()` å”¯ä¸€æ’å

``` sql
select
    ...,
    row_number() over (
        partition by åˆ†ç»„å­—æ®µ 
        order by æ’åºå­—æ®µ desc 
        rows between ... and ...
    ) as ...
from ...
```

| å‡½æ•° | ä½œç”¨ |
| --- | --- |
| rank | æ’åï¼Œä½†æ˜¯é‡åˆ°å¹¶åˆ—çš„æƒ…å†µä¼šè·³è¿‡å¹¶åˆ—çš„åæ¬¡ |
| dense_rank | åŒä¸Šï¼Œä½†æ˜¯ä¸è·³è¿‡å¹¶åˆ—çš„ |
| row_number | è¿ç»­åºå·ï¼Œå°±åƒç»™æ¯è¡Œä¸€ä¸ªåºå· |

#### ğŸ”˜ `lagã€lead`

ç”¨äºç›¸é‚»è¡Œçš„æ¯”è¾ƒ

### â­• é—®é¢˜

MySQL ä¸­ï¼Œå‡è®¾ç°åœ¨è¦ç»™ä¸€ä¸ªç­çº§çš„è¯­æ–‡æˆç»©è¿›è¡Œæ’åºã€‚ä½†æ˜¯ä¼šå‡ºç°åŒåˆ†çš„ç°è±¡ï¼Œè¯·ä½ ç»™å‡ºä¸€äº›ç®€å•çš„ç¤ºä¾‹å¹¶ç»™äºˆä¸‹é¢é—®é¢˜çš„è§£ç­”  
1ã€é‡åæ¬¡çš„è·³è¿‡ï¼Œä¾‹å¦‚æœ‰ä¸‰ä¸ªåŒå­¦éƒ½æ˜¯ç¬¬ 2 åï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªåæ¬¡ä¸ºç¬¬ 5 å  
2ã€é‡åæ¬¡çš„ä¸è·³è¿‡ï¼Œä¾‹å¦‚æœ‰ä¸‰ä¸ªåŒå­¦éƒ½æ˜¯ç¬¬ 2 åï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªåæ¬¡è¿˜ä¸ºç¬¬ 3 å  
è§£ç­”ï¼šhttps://dbfiddle.uk/p9Owpwod  




<style> 
    .note { 
        background-color: #f9f9f9; 
        border: 1px solid #ddd; 
        padding: 10px; 
        border-radius: 10px; 
        display: inline-block; 
        font-weight: bold;
        margin: 10px 0px;
    }
    .note:hover {
        animation: gradient-in 0.5s forwards;
    }
    .note:not(:hover) {
        animation: gradient-out 0.5s forwards;
    }
    @keyframes gradient-in {
        0% {
            background-color: #f9f9f9;
        }
        20% {
            background-color: #f5f5f5;
        }
        100% {
            background-color: #e1e1e1;
        }
    }
    @keyframes gradient-out {
        0% {
            background-color: #e1e1e1;
        }
        80% {
            background-color: #f5f5f5;
        }
        100% {
            background-color: #f9f9f9;
        }
    }
    .title1 { 
        font-size: 24px; 
        /* color: #333;  */
    } 
</style>