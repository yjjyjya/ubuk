<div class="container" style="text-align: center;">
    <div class="note">
        <span class="title1">âœ¨å‚è€ƒèµ„æ–™</span> 
    </div> 
</div>

åœ¨çº¿ç»ƒä¹ ï¼šhttps://dbfiddle.uk  
é»‘é©¬ï¼šhttps://github.com/cess-100/python-study2  

---
 
<div class="container" style="text-align: center;">
    <div class="note">
        <span class="title1">âœ¨åŸºæœ¬æ“ä½œ</span> 
    </div> 
</div>

windows ç³»ç»Ÿæ‰“å¼€ CMD  
è¾“å…¥ `mysql -u root -p` å›è½¦å†è¾“å…¥å¯†ç   

> [!NOTE|style:flat]
> SQL è¯­å¥æœ€åéœ€è¦ä»¥åˆ†å· `;` ç»“å°¾  
> å…³é”®å­—ä½¿ç”¨å¤§å°å†™å‡å¯  

æ˜¾ç¤ºæ•°æ®åº“ç‰ˆæœ¬ version  
`select version();`  

æ˜¾ç¤ºæ—¶é—´  
`select now();`  

æŸ¥çœ‹ç›®å‰æ‰€æœ‰çš„æ•°æ®åº“  
`show databases;`  

æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„æ•°æ®åº“  
`select database();`  

åˆ›å»ºç”¨äºç»ƒä¹ çš„æ•°æ®åº“ `mytest_school`ï¼Œå¹¶æŒ‡å®šç¼–ç   
`create database mytest_school charset=utf8;`  

åˆ‡æ¢åˆ°æ•°æ®åº“ `mytest_school`  
`use mytest_school;`  

åˆ é™¤æ•°æ®åº“  
`drop database if exists mytest_school;`  

é€€å‡º  
`exit` æˆ–è€… `quit`  

---

<div class="container" style="text-align: center;">
    <div class="note">
        <span class="title1">âœ¨æ•°æ®è¡¨çš„æ“ä½œ</span> 
    </div> 
</div>

æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨  
`show tables;`  

åˆ›å»ºè¡¨  
å…ˆæ˜¯å­—æ®µåï¼Œå†æ˜¯æŒ‡å®šç±»å‹ï¼Œä¾‹å¦‚ `int` æˆ–è€… `varchar` ç­‰ç­‰ï¼Œå†è®¾ç½®ä¸»é”®ï¼Œå†è®¾ç½®æ˜¯å¦ `not null`ï¼Œæœ€åè®¾ç½®å¯é€‰çš„ `default` å€¼  
`int unsigned` æ— ç¬¦å·æ•´å½¢  
`auto_increment` è®¾ç½®è‡ªå¢ï¼Œä¸€èˆ¬ç”¨äºä¸»é”®  
`not null` è®¾ç½®è¯¥å­—æ®µä¸èƒ½ä¸ºç©º  
`primary key` è®¾ç½®ä¸»é”®  
`default` è®¾ç½®é»˜è®¤å€¼  
`ENGINE=InnoDB` è®¾ç½® MySQL çš„å­˜å‚¨å¼•æ“  
``` sql
-- åˆ›å»ºå­¦ç”Ÿè¡¨
create table students(
    id int unsigned primary key auto_increment,
    name varchar(20) not null,
    age tinyint(1),
    high decimal(3,2),
    gender enum('ç”·', 'å¥³', 'ä¿å¯†'),
    cls_id int unsigned
);
```

æŸ¥çœ‹è¡¨ç»“æ„  
`desc classes;`  

### â­• å¢åˆ æ”¹æŸ¥ï¼ˆcurdï¼‰

#### ğŸ”˜ å¢

å…¨åˆ—æ’å…¥  
ä¸»é”®å­—æ®µå¯ä»¥ç”¨ `0`ã€`null`ã€`default` æ¥å ä½  
``` sql
-- å‘ students è¡¨ä¸­æ’å…¥æ•°æ®  
insert into students 
values 
    (null, 'å°é™†', 18, 1.78, 'ç”·', 1);
```

éƒ¨åˆ†æ’å…¥
``` sql
-- åªå‘ id å’Œ name å­—æ®µæ’å…¥å€¼
insert into students(id, name) 
values 
    (023, 'å°æ€');
```

å¤šè¡Œæ’å…¥
``` sql
-- æ³¨æ„é€—å·
insert into students 
values
    (null, 'å°é£', 18, 1.78, 'ç”·', 1),
    (null, 'å°æ™¨', 19, 1.61, 'å¥³', 3),
    (null, 'å°å±•', 19, 1.75, 'ç”·', 2);
```

> [!NOTE|style:flat]
> `insert into` æ’å…¥æ•°æ®æ—¶ä¼šæ£€æŸ¥ä¸»é”®ï¼Œ**é‡å¤åˆ™ä¼šæŠ¥é”™**  
> `replace into` é‡åˆ°é‡å¤çš„åˆ™æ˜¯ä¼šè¿›è¡Œ **æ›¿æ¢**  
> `insert ignore` é‡åˆ°é‡å¤çš„åˆ™æ˜¯ç›´æ¥ **å¿½ç•¥**  

#### ğŸ”˜ åˆ 

ç‰©ç†åˆ é™¤
``` sql
delete from students 
where id = 2;
```

é€»è¾‘åˆ é™¤  
ç”¨ä¸€ä¸ªå­—æ®µæ¥æ ‡è¯†è¿™æ¡ä¿¡æ¯æ˜¯å¦è¿˜èƒ½å†ä½¿ç”¨  
``` sql
-- ç»™ students è¡¨æ·»åŠ ä¸€ä¸ª bit ç±»å‹çš„ is_delete å­—æ®µï¼Œé»˜è®¤ä¸º 0  
alter table students 
add is_delete bit default 0;


update students 
set is_delete = 1 
where id = 3;
-- id ä¸º 3 çš„æ•°æ®è¢«æ ‡è®°ä¸ºä¸å¯ç”¨
```

#### ğŸ”˜ æ”¹

ä¿®æ”¹è¡¨
1. æ·»åŠ åˆ—  
`ALTER TABLE è¡¨å ADD COLUMN åˆ—å ç±»å‹ ã€first|after å­—æ®µåã€‘;`  
2. ä¿®æ”¹åˆ—çš„ç±»å‹æˆ–çº¦æŸ  
`ALTER TABLE è¡¨å MODIFY COLUMN åˆ—å æ–°ç±»å‹ ã€æ–°çº¦æŸã€‘;`  
3. ä¿®æ”¹åˆ—å  
`ALTER TABLE è¡¨å CHANGE COLUMN æ—§åˆ—å æ–°åˆ—å ç±»å‹;`  
4. åˆ é™¤åˆ—  
`ALTER TABLE è¡¨å DROP COLUMN åˆ—å;`  
5. ä¿®æ”¹è¡¨å  
`ALTER TABLE è¡¨å RENAME ã€toã€‘ æ–°è¡¨å;`  
6. ä¿®æ”¹å­—æ®µç¼ºçœå€¼  
`ALTER TABLE è¡¨å ALTER åˆ—å SET DEFAULT 1000;`  

``` sql
update students 
set high=1.56, gender='å¥³' 
where name='å°ç¯';
```

#### ğŸ”˜ æŸ¥

æŸ¥è¯¢æ‰€æœ‰åˆ—
``` sql
select * from students;
```

æŸ¥è¯¢æŒ‡å®šåˆ—
``` sql
select id, name from students;
```

æ¡ä»¶æŸ¥è¯¢
``` sql
select * from students where id=2;
```

ä½¿ç”¨ `as` ä¸ºåˆ—æˆ–è¡¨æŒ‡å®šåˆ«å
``` sql
select s.id as 'ç¼–å·', s.name as 'å§“å' from students as s;
```

#### ğŸ”˜ å…¶ä»–

- æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤ã€äº†è§£ã€‘

    ``` shell
    # å¯¼å‡ºæ•°æ®åº“ä¸º python.sql
    mysqldump â€“u root â€“p æ•°æ®åº“å > python.sql;

    # å¯¼å…¥æ•°æ®åº“
    mysql -u root â€“p æ–°æ•°æ®åº“å < python.sql;
    ```

- å¤åˆ¶è¡¨  
    1ã€åªå¤åˆ¶ç»“æ„  
    `CREATE TABLE b LIKE a` å¤åˆ¶ä¸€ä¸ªç»“æ„ä¸è¡¨ a ä¸€æ ·çš„è¡¨ b  
    2ã€å¤åˆ¶ç»“æ„åŠæ•°æ®  
    `CREATE TABLE b SELECT * FROM a` å¤åˆ¶ä¸€ä¸ªå’Œè¡¨ a ä¸€æ ·çš„è¡¨ b  

- è¿æ¥è¡¨  
    MySQL ä¸æ”¯æŒå…¨è¿æ¥ï¼Œä½¿ç”¨ `JOIN` éƒ½éœ€è¦æ­é… ONã€‚é»˜è®¤çš„ `JOIN` æ˜¯ `INNER JOIN`  
    å¦‚æœæƒ³è¦è¿æ¥ä¸¤ä¸ª **å«æœ‰ç›¸åŒå­—æ®µ** çš„è¡¨æ ¼ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹© `UNION` è¿æ¥  
    åŒºåˆ«æ˜¯ `UNION` åˆå¹¶ä¸¤ä¸ªè¡¨æ ¼æ—¶ä¼šè¿›è¡Œ **å»é‡**  
    `UNION ALL` åˆ™æ˜¯ **ç›´æ¥åˆå¹¶** èµ·æ¥  

- æ¡ä»¶è¯­å¥  

    ``` sql
    -- æ»¡è¶³æ¡ä»¶ a åˆ™æ˜¯ b
    -- ä¸æ»¡è¶³æ¡ä»¶ a åˆ™æ˜¯ c
    IF(a, b, c)

    -- ä¾‹å¦‚
    IF(x>5, 'å¤§', 'å°')
    ```

    ç­‰åŒäº  
    
    ``` sql
    CASE
        WHEN ... THEN ...
        WHEN ... THEN ...
        ELSE ...
    END AS ...
    ```

---

<div class="container" style="text-align: center;">
    <div class="note">
        <span class="title1">âœ¨å®Œæ•´ç»ƒä¹ </span> 
    </div> 
</div>

### â­• ç»ƒä¹  1

åˆ›å»ºå¹¶ä½¿ç”¨ `python_test_1` æ•°æ®åº“
``` sql
create database python_test_1 charset = utf8;
use python_test_1;
```

åˆ›å»ºå­¦ç”Ÿè¡¨
``` sql
drop table students;

create table students (
    id int unsigned primary key auto_increment not null,
    name varchar(20) default '',
    age tinyint unsigned default 0,
    height decimal(5, 2),
    gender enum ('ç”·', 'å¥³', 'ä¸­æ€§', 'ä¿å¯†') default 'ä¿å¯†',
    cls_id int unsigned default 0,
    is_delete bit default 0
);
```

åˆ›å»ºç­çº§è¡¨
``` sql
drop table classes;

create table classes (
    id int unsigned auto_increment primary key not null,
    name varchar(30) not null
);
```

æ’å…¥æ•°æ®
``` sql
insert into students
values 
    (0, 'å°æ˜', 18, 180.00, 2, 1, 0),
    (0, 'å°æœˆ', 18, 180.00, 2, 2, 1),
    (0, 'å°å½­', 29, 185.00, 1, 1, 0),
    (0, 'å°åˆ˜', 59, 175.00, 1, 2, 1),
    (0, 'å°é»„', 38, 160.00, 2, 1, 0),
    (0, 'å°å‡¤', 28, 150.00, 4, 2, 1),
    (0, 'å°ç‹', 18, 172.00, 2, 1, 1),
    (0, 'å°å‘¨', 36, NULL, 1, 1, 0),
    (0, 'å°ç¨‹', 27, 181.00, 1, 2, 0),
    (0, 'å°è²', 25, 166.00, 2, 2, 0),
    (0, 'å°é‡‘', 33, 162.00, 3, 3, 1),
    (0, 'å°é™', 12, 180.00, 2, 4, 0),
    (0, 'å°éƒ­', 12, 170.00, 1, 4, 0),
    (0, 'å°æ°', 34, 176.00, 2, 5, 0);
```
``` sql
insert into classes 
values 
    (0, 'python_01æœŸ'), 
    (0, 'python_02æœŸ');
```

æŸ¥è¯¢ç»ƒä¹ 
``` sql
select id as 'ç¼–å·', name as 'å§“å' from students;


select s.id, s.name from students as s;


-- distinct å…³é”®å­—ï¼Œå»é‡æŸ¥è¯¢
select distinct gender from students;


-- æ¯”è¾ƒè¿ç®—ç¬¦å’Œé€»è¾‘è¿ç®—ç¬¦æŸ¥è¯¢
select * from students 
where age > 18 or height >= 180;
-- æ”¯æŒ >=ã€<=ã€=ã€!= ç­‰


-- æ¨¡ç³ŠæŸ¥è¯¢
-- æŸ¥è¯¢å§“åè‡³å°‘æœ‰ 2 ä¸ªå­—çš„æ•°æ®
select * from students 
where name like '__%';
-- % ä»»æ„ä¸ª
-- _ 1ä¸ª


-- èŒƒå›´æŸ¥è¯¢
-- æŸ¥è¯¢å¹´é¾„ä¸º 18 æˆ–è€… 34 çš„å­¦ç”Ÿä¿¡æ¯
select * from students 
where age in (18,34);
-- æŸ¥è¯¢å¹´é¾„åœ¨ 18~34 ä¹‹é—´çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ 18 å’Œ 34 å²
select * from students where age>=18 and age<=34;
select * from students where age between 18 and 34;


-- is null åˆ¤æ–­å­—æ®µæ˜¯å¦ä¸ºç©º
select * from students 
where height is null;
```

æ’åº
``` sql
-- order by é»˜è®¤æ˜¯ä»å°åˆ°å¤§çš„å‡åºæ’åˆ— asc
-- é™åº desc

-- æŸ¥è¯¢å¹´é¾„åœ¨ 18 åˆ° 34 å²ä¹‹é—´çš„ç”·æ€§ï¼Œèº«é«˜ä»é«˜åˆ°çŸ®æ’åº, å¦‚æœèº«é«˜ç›¸åŒåˆ™æŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§æ’åº
select * from students 
where age between 18 and 34 and gender='ç”·'
order by height desc, age asc;
```

èšåˆå‡½æ•°
``` sql
-- æŸ¥è¯¢æ€»å…±æœ‰å¤šå°‘äºº
select count(*) as 'æ€»äººæ•°' from students;


-- æŸ¥è¯¢å¥³æ€§æœ€å¤§å¹´é¾„
select max(age) from students where gender='å¥³';


-- æŸ¥è¯¢ç”·æ€§æœ€çŸ®èº«é«˜
select min(height) from students where gender='ç”·';


-- å¹´é¾„æ€»å’Œ
select sum(age) from students;


-- å¹³å‡å¹´é¾„
select avg(age) from students;
select sum(age)/count(*) from students;


-- å››èˆäº”å…¥å‡½æ•°ï¼Œä¿ç•™ 2 ä½å°æ•°
select round(avg(height), 2) from students;
```

åˆ†ç»„
``` sql
-- è®¡ç®—å„æ€§åˆ«çš„äººæ•°
select gender, count(*) from students 
group by gender;
-- è®¡ç®—å„æ€§åˆ«ä¸­æœ€é«˜çš„èº«é«˜
select gender, max(height) from students 
group by gender;
-- ä»¥ä¸‹ä¸¤ä¸ªè¯­å¥ä¼šæŠ¥é”™
-- select * from students group by gender;
-- select gender, name from students group by gender;


-- group_concat ï¼Ÿï¼Ÿï¼Ÿ
-- æŸ¥è¯¢ç›¸åŒæ€§åˆ«ä¸­çš„å§“å
-- select gender, group_concat(name) from students group by gender;


-- æŸ¥è¯¢å¹³å‡å¹´é¾„è¶…è¿‡ 30 å²çš„æ€§åˆ«
select gender, avg(age) as tmp from students 
group by gender 
having tmp > 30;
-- èšåˆå‡½æ•°åœ¨ having å‰æ‰§è¡Œ
```

è¦æ±‚ **SELECTçš„åˆ—** åªèƒ½åœ¨ **ç”¨äºåˆ†ç»„çš„åˆ—** ä¸­é€‰æ‹©  
ä¾‹å¦‚å¯ä»¥ï¼š  
``` SQL
SELECT a,max(a),b
FROM mytable
GROUP BY a,b,c
```
ä¸èƒ½è¿™æ ·ï¼š  
``` SQL
SELECT a,b,c
FROM mytable
GROUP BY a,b
```

HAVING è¯­å¥  
    ``` SQL
    SELECT class
    FROM Courses
    GROUP BY class
    HAVING COUNT(class)>=5
    -- åˆ†ç»„åèšåˆï¼Œæ‰¾åˆ° class æ•°é‡å¤§äº 5 çš„
    ```
    ç­‰åŒäº  
    ``` SQL
    SELECT class FROM(
        SELECT 
            class,
            COUNT(student) AS a
        FROM Courses
        GROUP BY class
    ) AS t
    WHERE t.a>=5
    ```

`having ...` ç”¨äº **åˆ†ç»„èšåˆå** è¿›è¡Œä¸€äº›ç­›é€‰æ“ä½œï¼Œä¸æ¡ä»¶æŸ¥è¯¢ WHERE å­å¥çš„åŒºåˆ«åœ¨äºï¼ŒWHERE å­å¥ç”¨äºåœ¨ **åˆ†ç»„ä¹‹å‰** è¿›è¡Œè¿‡æ»¤ï¼Œè€Œ HAVING å­å¥ç”¨äºåœ¨ **åˆ†ç»„ä¹‹å** è¿›è¡Œè¿‡æ»¤



limit é™åˆ¶
``` sql
-- é™åˆ¶æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä¸ªæ•°
-- æŸ¥è¯¢å‰ 5 ä¸ªæ•°æ®
select * from students limit 0, 5;
select * from students limit 5;


-- åˆ†é¡µæŸ¥è¯¢
-- æ¯é¡µæ˜¾ç¤º b ä¸ªï¼Œæ˜¾ç¤ºç¬¬ a é¡µçš„ä¿¡æ¯
-- select * from students limit b*(a-1), b;
-- æ¯é¡µæ˜¾ç¤º 2 ä¸ªï¼Œç¬¬ 1 ä¸ªé¡µé¢
select * from students limit 0, 2;
-- æ¯é¡µæ˜¾ç¤º 2 ä¸ªï¼Œæ˜¾ç¤ºç¬¬ 6 é¡µçš„ä¿¡æ¯
select * from students limit 10, 2;
```

è¡¨è¿æ¥
``` sql
-- å°†å­¦ç”Ÿè¡¨å’Œç­çº§è¡¨æ ¹æ®ç­çº§ id è¿æ¥èµ·æ¥
select * from students 
inner join classes 
on students.cls_id = classes.id;


-- ç»™è¡¨æŒ‡å®šåˆ«å
select s.name, c.name from students as s 
inner join classes as c 
on s.cls_id = c.id;
-- ä½¿ç”¨ where è¯­å¥æ˜¯ç­‰ä»·çš„
select s.name, c.name from students as s, classes as c 
where s.cls_id = c.id;


-- å·¦è¿æ¥ left join
-- å³è¿æ¥ right join
-- æ³¨æ„ï¼šè¡¨å¯ä»¥å’Œè‡ªå·±è¿æ¥
```


- å…³è”è¡¨æ ¼ï¼š
    `cross join` ä¸¤ä¸¤ç»“åˆï¼Œä¸éœ€è¦æ¡ä»¶
    `inner join` æˆ–è€… `join` æ»¡è¶³å¯¹åº”çš„æ¡ä»¶æ‰å¯ä»¥ç»„åˆåœ¨ä¸€èµ·
    `left join`ã€`right join` å±äº outer join




å­æŸ¥è¯¢
``` sql
-- æ ‡é‡å­æŸ¥è¯¢ï¼Œè¿”å›ç»“æœä¸ºæ ‡é‡
-- åˆ—å­æŸ¥è¯¢ï¼Œè¿”å›ç»“æœä¸ºä¸€åˆ—
-- è¡Œå­æŸ¥è¯¢ï¼Œè¿”å›ç»“æœä¸ºä¸€è¡Œ


-- æŸ¥å‡ºé«˜äºå¹³å‡èº«é«˜çš„æ•°æ®
select * from students
where height > (
    select avg(height) from students
);
-- å­æŸ¥è¯¢è¯­å¥ä¸éœ€è¦åˆ†å·
```

### â­• ç»ƒä¹ 2

åˆ›å»ºå¹¶ä½¿ç”¨ `JD` æ•°æ®åº“
``` sql
create database JD charset = utf8;
use JD;
```

åˆ›å»ºå•†å“è¡¨
``` sql
drop table goods;

create table goods (
    id int unsigned primary key auto_increment not null,
    name varchar(150) not null,
    cate_name varchar(40) not null,
    brand_name varchar(40) not null,
    price decimal(10, 3) not null default 0,
    is_show bit not null default 1,
    is_saleoff bit not null default 0
);
```

``` sql
insert into goods 
values  
    (0, 'r510vc 15.6è‹±â¼¨ç¬”è®°æœ¬', 'ç¬”è®°æœ¬', 'åç¡•', '3399', default, default);
    (0, 'y400n 14.0è‹±â¼¨ç¬”è®°æœ¬ç”µè„‘', 'ç¬”è®°æœ¬', 'è”æƒ³', '4999', default, default);
    (0, 'g150th 15.6è‹±â¼¨æ¸¸æˆæœ¬', 'æ¸¸æˆæœ¬', 'é›·ç¥', '8499', default, default);
    (0, 'x550cc 15.6è‹±â¼¨ç¬”è®°æœ¬', 'ç¬”è®°æœ¬', 'åç¡•', '2799', default, default);
    (0, 'x240 è¶…ææœ¬', 'è¶…çº§æœ¬', 'è”æƒ³', '4880', default, default);
    (0, 'u330p 13.3è‹±â¼¨è¶…ææœ¬', 'è¶…çº§æœ¬', 'è”æƒ³', '4299', default, default);
    (0, 'svp13226scb è§¦æ§è¶…ææœ¬', 'è¶…çº§æœ¬', 'ç´¢å°¼', '7999', default, default);
    (0, 'ipad mini 7.9è‹±â¼¨å¹³æ¿ç”µè„‘', 'å¹³æ¿ç”µè„‘', 'è‹¹æœ', '1998', default, default);
    (0, 'ipad air 9.7è‹±â¼¨å¹³æ¿ç”µè„‘', 'å¹³æ¿ç”µè„‘', 'è‹¹æœ', '3388', default, default);
    (0, 'ipad mini é…å¤‡ retina æ˜¾ç¤ºå±', 'å¹³æ¿ç”µè„‘', 'è‹¹æœ', '2788', default, default);
    (0, 'ideacentre c340 20è‹±â¼¨â¼€ä½“ç”µè„‘ ', 'å°å¼æœº', 'è”æƒ³', '3499', default, default);
    (0, 'vostro 3800-r1206 å°å¼ç”µè„‘', 'å°å¼æœº', 'æˆ´å°”', '2899', default, default);
    (0, 'imac me086ch/a 21.5è‹±â¼¨â¼€ä½“ç”µè„‘', 'å°å¼æœº', 'è‹¹æœ', '9188', default, default);
    (0, 'at7-7414lp å°å¼ç”µè„‘ linux ï¼‰', 'å°å¼æœº', 'å®ç¢', '3699', default, default);
    (0, 'z220sff f4f06paâ¼¯ä½œç«™', 'æœåŠ¡å™¨/â¼¯ä½œç«™', 'æƒ æ™®', '4288', default, default);
    (0, 'poweredge iiæœåŠ¡å™¨', 'æœåŠ¡å™¨/â¼¯ä½œç«™', 'æˆ´å°”', '5388', default, default);
    (0, 'mac proä¸“ä¸šçº§å°å¼ç”µè„‘', 'æœåŠ¡å™¨/â¼¯ä½œç«™', 'è‹¹æœ', '28888', default, default);
    (0, 'hmz-t3w å¤´æˆ´æ˜¾ç¤ºè®¾å¤‡', 'ç¬”è®°æœ¬é…ä»¶', 'ç´¢å°¼', '6999', default, default);
    (0, 'å•†åŠ¡åŒè‚©èƒŒåŒ…', 'ç¬”è®°æœ¬é…ä»¶', 'ç´¢å°¼', '99', default, default);
    (0, 'x3250 m4æœºæ¶å¼æœåŠ¡å™¨', 'æœåŠ¡å™¨/â¼¯ä½œç«™', 'ibm', '6888', default, default);
    (0, 'å•†åŠ¡åŒè‚©èƒŒåŒ…', 'ç¬”è®°æœ¬é…ä»¶', 'ç´¢å°¼', '99', default, default);
```

æŸ¥è¯¢ç»ƒä¹ 

``` sql
-- æŸ¥è¯¢æ¯ç§ç±»å‹çš„å•†å“ä¸­æœ€è´µ max ã€æœ€ä¾¿å®œ min ã€å¹³å‡ä»· avg ã€æ•°é‡ count
select cate_name, max(price), min(price), avg(price), count(*) from goods 
group by cate_name;
```

``` sql
-- æŸ¥è¯¢æ¯ç§ç±»å‹ä¸­æœ€è´µçš„ç”µè„‘çš„æ‰€æœ‰ä¿¡æ¯
select * from goods 
where price in (
    select max(price) from goods 
    group by cate_name
);
-- æ³¨æ„å­æŸ¥è¯¢é‡Œé¢ä¸ç”¨åˆ†å·
```

``` sql
-- æ¯ç§ç±»å‹ä¸­æœ€è´µçš„ç‰©å“ä¿¡æ¯
select * from goods
inner join (
    select cate_name, max(price) as max_price from goods 
    group by cate_name
) as max_price_goods
on goods.cate_name = max_price_goods.cate_name and goods.price = max_price_goods.max_price;


-- æˆ–è€…
select cate_name, max(price), group_concat(name) from goods 
group by cate_name;
```

é€šè¿‡å­æŸ¥è¯¢æ’å…¥æ•°æ®åˆ°æ–°çš„åˆ†ç±»è¡¨ä¸­

``` sql
insert into goods_cates(name) 
    select cate_name from goods 
    group by cate_name;
```

æ”¹ update æ“ä½œç»ƒä¹ 

``` sql
-- æŠŠå•†å“è¡¨ goods ä¸­çš„ cate_name å…¨éƒ¨æ›¿æ¢æˆå•†å“åˆ†ç±»è¡¨ä¸­çš„å•†å“ id
update goods 
inner join goods_cates 
on goods.cate_name = goods_cates.name 
set goods.cate_name = goods_cates.id;
```

``` sql
-- ä¿®æ”¹è¡¨ç»“æ„ï¼ŒæŠŠ cate_name æ”¹æˆ cate_id int unsigned not null
alter table goods 
change cate_name 
cate_id int unsigned not null;
```

æ·»åŠ å¤–é”®  
ä½œç”¨ï¼šç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§  
``` sql
-- alter table è¡¨å add foreign key (å¤–é”®å­—æ®µ) references è¡¨å(ä¸»é”®id)
alter table goods 
add foreign key (cate_id) 
references goods_cates(id);
-- åœ¨ goods è¡¨ä¸­æ·»åŠ ä¸€ä¸ªå¤–é”® cate_idï¼Œè¯¥å¤–é”®ä¸ goods_cates è¡¨çš„ id å­—æ®µç›¸å…³è”
-- è¿™æ„å‘³ç€åœ¨å‘ goods è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œcate_id å­—æ®µçš„å€¼å¿…é¡»å­˜åœ¨äºgoods_cates è¡¨çš„ id å­—æ®µä¸­ï¼Œå¦åˆ™å°†ä¼šå¼•å‘å¤–é”®çº¦æŸé”™è¯¯
```
æœ‰æ—¶å€™æ‰§è¡Œä¸Šè¿°è¯­å¥ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯å½“å‰æ•°æ®åº“å°±å­˜åœ¨ç€ä¸€äº›ä¸ç¬¦åˆè§„åˆ™çš„æ•°æ®ï¼Œéœ€è¦å…ˆåˆ é™¤é‚£äº›æ•°æ®ï¼Œå†é‡æ–°æ·»åŠ å¤–é”®  

``` sql
-- åˆ›å»ºè¡¨çš„åŒæ—¶å¯ä»¥è®¾ç½®å¤–é”®
-- æ³¨æ„ goods_cates å’Œ goods_brands ä¸¤ä¸ªè¡¨å¿…é¡»äº‹å…ˆå­˜åœ¨
create table goods_test(
    id       int primary key auto_increment,
    name     varchar(150) not null,
    cate_id  int unsigned not null,
    brand_id int unsigned not null,
    foreign key (cate_id) references goods_cates (id),
    foreign key (brand_id) references goods_brands (id)
);
```

``` sql
-- æŸ¥çœ‹å¤–é”®å
show create table goods_test;

-- è·å–åç§°ä¹‹åå°±å¯ä»¥æ ¹æ®åç§°æ¥åˆ é™¤å¤–é”®çº¦æŸ
alter table goods_test 
drop foreign key goods_test_ibfk_1;
```

ä»€ä¹ˆæ˜¯è§†å›¾?  
é€šä¿—çš„è®²ï¼Œè§†å›¾å°±æ˜¯ä¸€æ¡ select è¯­å¥æ‰§è¡Œåè¿”å›çš„ç»“æœé›†  

è§†å›¾çš„ç‰¹ç‚¹  
è§†å›¾æ˜¯å¯¹è‹¥å¹²å¼ åŸºæœ¬è¡¨çš„å¼•ç”¨ï¼Œä¸€å¼  **è™šè¡¨**ï¼ŒæŸ¥è¯¢è¯­å¥æ‰§è¡Œçš„ç»“æœï¼Œ
ä¸å­˜å‚¨å…·ä½“çš„æ•°æ®ï¼Œ**åŸºæœ¬è¡¨æ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼Œè§†å›¾ä¹Ÿä¼šè·Ÿç€æ”¹å˜**  

è§†å›¾æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æŸ¥è¯¢çš„SQLè¯­å¥ï¼Œä½œç”¨å¦‚ä¸‹ï¼š  
1ã€è§†å›¾å¯ä»¥ **éšè—ä¸€äº›æ•°æ®**ï¼Œå¦‚ï¼šç¤¾ä¼šä¿é™©åŸºé‡‘è¡¨ï¼Œå¯ä»¥ç”¨è§†å›¾åªæ˜¾ç¤ºå§“åï¼Œåœ°å€ï¼Œè€Œä¸æ˜¾ç¤ºç¤¾ä¼šä¿é™©å·å’Œå·¥èµ„æ•°ç­‰  
2ã€ä½¿å¤æ‚çš„æŸ¥è¯¢æ˜“äºç†è§£å’Œä½¿ç”¨  

è§†å›¾é‡è¦çš„æ„ä¹‰  
ç¨‹åºå¯¹æ•°æ®åº“æ“ä½œï¼Œä¸€æ—¦æ•°æ®åº“å‘ç”Ÿå˜åŒ–ï¼Œç¨‹åºå°±éœ€è¦ä¿®æ”¹  
è¿™æ—¶å¦‚æœä½¿ç”¨è§†å›¾è€Œéæ™®é€šè¡¨æ ¼ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜  

``` sql
-- å®šä¹‰è§†å›¾
-- åˆ›å»ºè§†å›¾ v_goods_infoï¼ŒæŸ¥å‡ºäº§å“è¡¨ä¸­äº§å“åç§°ã€åˆ†ç±»åç§°ä»¥åŠå¯¹åº”å“ç‰Œ
create view v_goods_info as
    select goods.name gname, goods_cates.name gcname, goods_brands.name gbname
    from goods
        inner join goods_cates on goods.cate_id = goods_cates.id
        inner join goods_brands on goods.brand_id = goods_brands.id;

-- show tables; ä¼šæ˜¾ç¤ºè¡¨å’Œè§†å›¾
```

``` sql
-- å½“åŸè¡¨äº§å“åç§°æ”¹å˜åï¼Œä¼šå½±å“è§†å›¾ï¼ˆè§†å›¾æ˜¯è™šæ‹Ÿè¡¨ï¼‰
update goods set name = 'xxx' where id = 24;
```

``` sql
-- åˆ é™¤è§†å›¾
drop view v_goods_info;
```

äº‹åŠ¡(ACID)

åŸºæœ¬ä½¿ç”¨ï¼š
1ã€æ‰“å¼€äº‹åŠ¡ begin æˆ– start transaction  
2ã€æ“ä½œåŒ…æ‹¬ insertã€updateã€delete  
3ã€ç¡®è®¤ä¿®æ”¹ commit  
4ã€åæ‚”è¿›è¡Œå›æ»š  rollback;  

å›æ»š(rollback)æ“ä½œ  
ç¬¬ä¸€æ­¥ æ‰“å¼€ç»ˆç«¯ 1 `begin`  
ç¬¬äºŒæ­¥ ç»ˆç«¯ 1 æ‰§è¡Œ `update è¡¨å set å­—æ®µ="xxx" where ...;`  
ç¬¬ä¸‰æ­¥ å†æ‰§è¡Œ `rollback`ï¼Œæ•°æ®è¿”å›æœ€å¼€å§‹çš„åŸå§‹å€¼ `show engines;`  

åŸå­æ€§ ä¸€è‡´æ€§  
ç¬¬ä¸€æ­¥ æ‰“å¼€ç»ˆç«¯ 1 å’Œç»ˆç«¯ 2  
ç¬¬äºŒæ­¥ ç»ˆç«¯ 1 æ‰“å¼€äº‹åŠ¡ `begin`ï¼Œæ‰§è¡Œ `update è¡¨å set å­—æ®µ="xxx" where ...;`ï¼Œå†æ‰§è¡Œ `select * from è¡¨å;` å‘ç°æ•°æ®æ”¹å˜  
ç¬¬ä¸‰æ­¥ ç»ˆç«¯ 2 `select * from è¡¨å;`ï¼Œå‘ç°æ•°æ®å…¶å®å¹¶æ²¡æœ‰æ”¹å˜ï¼ˆå…¶å®è¿™ä¸ªæ—¶å€™å¯¹æ•°æ®çš„ç›¸å…³æ“ä½œä¿¡æ¯å­˜åœ¨ç¼“å­˜ä¸­ï¼Œå½“ commit ä¹‹å
,è¿™äº›æ“ä½œæ‰ä¼šä¸€æ¬¡æ€§çš„å®Œæˆï¼‰  
ç¬¬å››æ­¥ ç»ˆç«¯ 1 `commit`ï¼Œç»ˆç«¯ 2 `select * from è¡¨å`ï¼Œæ•°æ®æ”¹å˜äº†  


éš”ç¦»æ€§  
ç¬¬ä¸€æ­¥ æ‰“å¼€ç»ˆç«¯ 1 å’Œç»ˆç«¯ 2  
ç¬¬äºŒæ­¥ ç»ˆç«¯ 1 æ‰“å¼€äº‹åŠ¡ `begin`ï¼Œæ‰§è¡Œ `update è¡¨å set å­—æ®µ="xxx" where ...;`  
ç¬¬ä¸‰æ­¥ ç»ˆç«¯ 2 æ‰§è¡Œ `update è¡¨å set å­—æ®µ="yyy" where ...;`ï¼Œå‘ç°å¤„äº **é˜»å¡** çŠ¶æ€  
ç¬¬å››æ­¥ ç»ˆç«¯ 1 `commit`ï¼Œç»ˆç«¯ 2 é˜»å¡çŠ¶æ€è§£é™¤ï¼Œæ•°æ®ä¿®æ”¹æˆåŠŸ  

æŒä¹…æ€§  
ä¸€æ—¦äº‹åŠ¡æäº¤ `commit`ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹ä¼šæ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“  

> [!NOTE|style:flat]
> innodb èƒ½ä½¿ç”¨äº‹åŠ¡  
> ä½¿ç”¨ python å’Œ **ç»ˆç«¯** æ“ä½œæ•°æ®åº“(ä¹Ÿå°±æ˜¯mysqlçš„å®¢æˆ·ç«¯)çš„æ—¶å€™æ˜¯ **é»˜è®¤å¼€å¯äº‹åŠ¡**  
> ä½†æ˜¯ python å¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹çš„æ—¶å€™ éœ€è¦æ‰‹åŠ¨ commit  
> è€Œç»ˆç«¯å›è½¦åä¼šé»˜è®¤çš„ commit  

äº‹åŠ¡é‡è¦çš„æ„ä¹‰  
æŸäº›äº‹æƒ…éœ€è¦ä¸€æ¬¡æ€§å®Œæˆ **ä¸­é€”ä¸å…è®¸å‡ºç°ä¸­æ–­**  
ä¾‹å¦‚é“¶è¡Œå–é’±ï¼Œäº‹åŠ¡å¯ä»¥è§£å†³è¿™ç§é—®é¢˜  

SQL æ³¨å…¥  
ä¸ºäº†é˜²æ­¢ SQL æ³¨å…¥æ”»å‡»ï¼Œåº”è¯¥ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–è€…é¢„ç¼–è¯‘è¯­å¥ï¼Œç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¢« **æ­£ç¡®åœ°è½¬ä¹‰å’Œå¤„ç†**ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‹¼æ¥åˆ° SQL è¯­å¥ä¸­

### â­• ç»ƒä¹ 3

åˆ›å»ºè¡¨æ ¼
``` sql
DROP TABLE IF EXISTS `student`;
CREATE TABLE student(
    SId VARCHAR(3) NOT NULL, 
    Sname VARCHAR(4) NOT NULL,
    Sage DATE,
    Ssex VARCHAR(2) NOT NULL,
    PRIMARY KEY(SId)
); -- åˆ›å»ºè¡¨æ ¼student

CREATE TABLE teacher(
    TId VARCHAR(3) NOT NULL, 
    Tname VARCHAR(4) NOT NULL,
    PRIMARY KEY(TId)
); -- åˆ›å»ºè¡¨æ ¼teacher

CREATE TABLE sc(
    SId VARCHAR(3) NOT NULL, 
    CId VARCHAR(3) NOT NULL, 
    score VARCHAR(3) NOT NULL
); -- åˆ›å»ºè¡¨æ ¼sc

CREATE TABLE course(
    CId VARCHAR(3) NOT NULL, 
    Cname VARCHAR(4) NOT NULL,
    TId VARCHAR(3) NOT NULL,
    PRIMARY KEY(CId)
); -- åˆ›å»ºè¡¨æ ¼course
```

å‘è¡¨æ ¼ student æ’å…¥æ•°æ®
``` sql
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (10,'æå››'
,'2017/12/25 0:00:00','å¥³');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (11,'æå››'
,'2012/6/6 0:00:00','å¥³');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (13,'å­™ä¸ƒ'
,'2014/6/1 0:00:00','å¥³');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (02,'é’±ç”µ'
,'1990/12/21 0:00:00','ç”·');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (03,'å­™é£'
,'1990/12/20 0:00:00','ç”·');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (06,'å´å…°'
,'1992/1/1 0:00:00','å¥³');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (01,'èµµé›·'
,'1990/1/1 0:00:00','ç”·');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (04,'æäº‘'
,'1990/12/6 0:00:00','ç”·');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (09,'å¼ ä¸‰'
,'2017/12/20 0:00:00','å¥³');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (12,'èµµå…­'
,'2013/6/13 0:00:00','å¥³');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (07,'éƒ‘ç«¹'
,'1989/1/1 0:00:00','å¥³');
INSERT INTO student(SId,Sname,Sage,Ssex) VALUES (05,'å‘¨æ¢…'
,'1991/12/1 0:00:00','å¥³');
```

å‘è¡¨æ ¼ teacher æ’å…¥æ•°æ®
``` sql
INSERT INTO teacher(TId,Tname) VALUES (01,'å¼ ä¸‰');
INSERT INTO teacher(TId,Tname) VALUES (02,'æå››');
INSERT INTO teacher (TId,Tname) VALUES (03,'ç‹äº”');
```

å‘è¡¨æ ¼ sc æ’å…¥æ•°æ®
``` sql
INSERT INTO sc(SId,CId,score) VALUES (01,03,99);
INSERT INTO sc(SId,CId,score) VALUES (02,03,80);
INSERT INTO sc(SId,CId,score) VALUES (01,02,90);
INSERT INTO sc(SId,CId,score) VALUES (07,02,89);
INSERT INTO sc(SId,CId,score) VALUES (04,01,50);
INSERT INTO sc(SId,CId,score) VALUES (04,02,30);
INSERT INTO sc(SId,CId,score) VALUES (07,03,98);
INSERT INTO sc(SId,CId,score) VALUES (05,02,87);
INSERT INTO sc(SId,CId,score) VALUES (06,01,31);
INSERT INTO sc(SId,CId,score) VALUES (06,03,34);
INSERT INTO sc(SId,CId,score) VALUES (02,01,70);
INSERT INTO sc(SId,CId,score) VALUES (03,01,80);
INSERT INTO sc(SId,CId,score) VALUES (01,01,80);
INSERT INTO sc(SId,CId,score) VALUES (03,02,80);
INSERT INTO sc(SId,CId,score) VALUES (03,03,80);
INSERT INTO sc(SId,CId,score) VALUES (02,02,60);
INSERT INTO sc(SId,CId,score) VALUES (04,03,20);
INSERT INTO sc(SId,CId,score) VALUES (05,01,76);
```

å‘è¡¨æ ¼ course æ’å…¥æ•°æ®
``` sql
INSERT INTO course(CId,Cname,TId) VALUES (03, 'è‹±è¯­',03);
INSERT INTO course(CId,Cname,TId) VALUES (02, 'æ•°å­¦',01);
INSERT INTO course(CId,Cname,TId) VALUES (01, 'è¯­æ–‡',02);
```

æŸ¥çœ‹ç°åœ¨æœ‰å“ªäº›è¡¨æ ¼
`SHOW TABLES;`

æŸ¥çœ‹è¡¨æ ¼ student çš„ç»“æ„
`DESC student;`

å±•ç¤ºè¡¨æ ¼ student çš„æ•°æ®
`SELECT * FROM student;`

å¯ä»¥å¼€å§‹ç»ƒä¹ ç­›é€‰ç­‰ç­‰è¯­å¥
æ¨èç½‘å€ï¼šhttps://dbfiddle.uk/aTtDOcMu
é‡Œé¢æœ‰ä¸€äº›ç­›é€‰é—®é¢˜

åˆ é™¤è¡¨æ ¼ä¸­çš„æŸäº›å­—æ®µ
``` sql
ALTER TABLE student
DROP COLUMN Sage,
DROP COLUMN Ssex;
```

åˆ é™¤è¡¨æ ¼
``` sql
DROP TABLE student;
DROP TABLE teacher;
DROP TABLE sc;
DROP TABLE course;
```

åˆ é™¤æ•°æ®åº“
`DROP DATABASE mytest_school;`
`SHOW DATABASES;`





<style> 
    .note { 
        background-color: #f9f9f9; 
        border: 1px solid #ddd; 
        padding: 10px; 
        border-radius: 10px; 
        display: inline-block; 
        font-weight: bold;
        margin: 10px 0px;
    }
    .note:hover {
        animation: gradient-in 0.5s forwards;
    }
    .note:not(:hover) {
        animation: gradient-out 0.5s forwards;
    }
    @keyframes gradient-in {
        0% {
            background-color: #f9f9f9;
        }
        20% {
            background-color: #f5f5f5;
        }
        100% {
            background-color: #e1e1e1;
        }
    }
    @keyframes gradient-out {
        0% {
            background-color: #e1e1e1;
        }
        80% {
            background-color: #f5f5f5;
        }
        100% {
            background-color: #f9f9f9;
        }
    }
    .title1 { 
        font-size: 24px; 
        /* color: #333;  */
    } 
</style>